$(function(){
var chatmessages = {
    username : 'bot',
    name: 'El puto bot',
    avatar: 'https://bootdey.com/img/Content/avatar/avatar2.png',
    text: 'Hi',
    ago: '5 min ago' 
    
};   
drawmessages(chatmessages);
})
window.addEventListener('keypress', function (e) {
    if (e.keyCode == 13) {
      $(".chat").niceScroll();
      ajaxFunction();
    }
}, false);

function drawmessages(chatmessages){
    let htmldiv = ``;
    let position = chatmessages.username=='bot'? 'left': 'right';
    let ago = chatmessages.ago;
    let createtagdiv = document.createElement('div');
    // createtagdiv.setAttribute("class", "answer ${position}");
    // let createtagdiv2 = document.createElement('div');
    // createtagdiv2.setAttribute("class", "avatar");

    htmldiv = `<div class="answer ${position}">
    
            <div class="avatar">
            <img src="${chatmessages.avatar}" alt="${chatmessages.name}">
            <div class="status offline"></div>
            </div>
            <div class="name">${chatmessages.name}</div>
            <div class="text">
            ${chatmessages.text}
            </div>
            <div class="time">${ago}</div>
        </div>`;
        createtagdiv.innerHTML = htmldiv;
    /*console.log(htmldiv);*/
    $( "div#chat-messages" ).append(createtagdiv);
    $(".chat").niceScroll();
}

function ajaxFunction() {
  var chatme = document.getElementById('chatcontent').value;
 
  $.ajax({
      url: '/translate',
      data: chatme,
      type: 'POST',
      contentType: false,
      cache: false,
      processData: false,
      success: function (response) {

       
        chatmessages ={
          username : 'Me',
          name: 'Me',
          avatar: 'https://bootdey.com/img/Content/avatar/avatar1.png',
          text: chatme,
          ago: '1 min ago'   
        };
        drawmessages(chatmessages);
        var temp = JSON.parse(response)
        var chatbot = temp['text'];
        chatmessagesbot ={
          username : 'bot',
          name: 'bot',
          avatar: 'https://bootdey.com/img/Content/avatar/avatar1.png',
          text: chatbot,
          ago: '1 min ago'   
        };
        drawmessages(chatmessagesbot);


      },
      error: function (error) {
          console.log(error);
      }
  });
}